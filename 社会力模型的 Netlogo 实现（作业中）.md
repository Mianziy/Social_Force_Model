# 社会力模型的 Netlogo 实现 #

本程序将在 Netlogo 环境下，实现社会力模型的核心部分。您可以在此基础上增加、修改相应参变量或者逻辑，以达到您研究的目的。

## 1. 什么是社会力模型 ##

社会力模型（Social-Force Model）是 D. Helbing 与 P. Molnár 于1995年提出的，并在之后不断完善的理论模型，其在计算机疏散仿真领域有着广泛应用。

社会力模型的核心是基于运动公式的一组描述个体自身特征同周围环境联系的方程：

$$ F_i = m_i*dv_i/dt = f_i + \sum_{i(\ne j)}f_j + \sum_W f_{iW},\tag1 $$

其中， $f_i$ 所表示的是个体的内心驱动力，其具体为：

$$ f_i = m_i[v_i^0 (t) e_i^0 (t)-v_i (t)]/τ_i,\tag2 $$

对于特定事物及出口的吸引力 $f_0$，其由形如式.3的公式确定：

$$ f_0= A_i*exp[(r_i-d_i)⁄B_i],\tag3 $$

$ \sum_{i(\ne j)}f_j $ 是个体所受来自其他个体的作用力的合力；而来自单个个体的作用力 $F_{ij}$ 可表示为：

$$ F_{ij}= {A_i*exp[(r_{ij}- d_{ij})/B_i ]+ kg(r_{ij}- d_{ij} )} n_{ij}  - \\κg(r_{ij}- d_{ij} )Δv_{ji}^t  t_{ij},\tag4 $$

而来自障碍物的排斥力 $F_{iW}$ 可表示为：

$$ F_iW= {A_i*exp[(r_i- d_{iW})/B_i ]+ kg(r_i- d_{iW} )} n_iW  -\\κg(r_i- d_{iW} )(v_i*t_{iW} )t_{iW},\tag5 $$

注: 上述公式及符号的具体含义请参考: D. Helbing et al. _Simulating dynamical features of escape panic_ [J]. Nature, 2000, 407(6803): 487–490.
## 2. 基于 Netlogo 的社会力模型的实现 ##

在 Netlogo 中，可供操作的主体分为`海龟(turtles)`、`瓦片(patches)`、`链(links)`，以及`观察者(observe)`。我们通过将社会力模型，即式.1分为三部分，并借由`海龟(turtles)`、`瓦片(patches)`、`链(links)`分别表示，以在 Netlogo 环境下实现社会力模型。

#### 场景的设置 ####

在交互界面的`设置`选项中将`世界`，即场景调整至合适大小，这里将场景设置为$ 27 * 27 $ 大小的网格。注意将`世界在水平方向循环`和`世界在垂直方向循环`的选项取消。

通过`按钮`以及`数据监视框`等选项为程序添加需要的交互项。这里需要将`setup`和`go`按钮，以及计算场景剩余人数的数据监视框和调整初始人数的`滑动条`添加在交互界面。注意将`go`按钮设置中勾选`循环执行`。

#### 程序的编制 ####

在`程序`界面，我们将完成社会力模型仿真程序的剩余部分。

##### 变量的定义和设置 #####

在程序的开头部分，我们将定义不同的种类的海龟和链，并设置全局变量和有关内置变量。

通过`breed [<breeds> <breed>]`函数将主体定义为不同种类，这样可以使其遵循不同的命令。

```
breed[hitobito hito]	
;; 设置一种名为“人”的海龟
directed-link-breed[in-forces in-force]
;; 设置名为“个体间相互作用力”的有向链
```

通过`globals [var1 ...]`函数定义全局变量，其能由任何主体访问，并允许在程序任何地方使用。

```
globals[		;; 定义全局变量
  Ai Bi Bii 	;; 定义式.3中的参数 A_i 与 B_i
  k kappa		;; 定义式.4及式.5中的参数 k 与 κ
  pre			;; 定义一个中间参数
  num-hibobito 	;; 定义一个初始海龟数量，即人数的参数	
]
```

通过`<breeds>-own`、`<link-breeds>-own`,以及`patches-own`函数，为相应主体赋予不同的属性与参数。同全局变量不同，内置变量对于不同个体可以完全不一样。

```
hitobito-own[	;; 定义“人”的内置参数
  v0			;; 定义初始速度
  v				;; 定义实际速度
  mass			;; 定义质量
  radii			;; 定义半径(社会力模型中通常将个体视为圆形粒子)
  tau			;; 定义恐慌参数 τ_i
  fidx fidy		;; 定义水平及竖直方向的个体间相互作用力
  fiWdx fiWdy	;; 定义水平及竖直方向的障碍物排斥力
]

in-forces-own[	;; 定义“个体间相互作用力”的内置参数
  g				;; 定义重力加速度 g
  dij			;; 定义个体间距离 d_ij
  fij			;; 定义个体间相互作用力 f_ij
  fij-nor		;; 定义 f_ij 的法向分力 
  fij-tan		;; 定义 f_ij 的切向分力
  fijdx fijdy	;; 定义 f_ij 在水平与竖直方向上的分力
  ang			;; 定义 f_ij 即有向链的角度
]

```

